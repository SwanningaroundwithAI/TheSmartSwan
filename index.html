<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Assistant</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0; /* Light blue-gray track */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; /* Darker blue-gray thumb */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* Even darker blue-gray on hover */
        }
        /* Styles for urgent task */
        .urgent-task {
            background-color: #fffbeb !important; /* Bright yellow background */
            border-color: #fcd34d !important; /* Yellow border */
        }
        /* Styles for blocked/dependent tasks */
        .blocked-task {
            background-color: #e0e7ff !important; /* Light blue */
            border-color: #93c5fd !important; /* Blue border */
            opacity: 0.7;
            pointer-events: none; /* Disable interaction */
        }
        .blocked-task .text-gray-800 {
            color: #6b7280 !important; /* Darker gray for text */
        }
        canvas {
            display: block; /* Remove extra space below canvas */
            max-width: 100%;
            height: auto;
        }
        .note-content-preview {
            max-height: 60px; /* Limit height of preview */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; /* Prevent wrapping in preview */
        }
        .note-full-content {
            white-space: pre-wrap; /* Preserve whitespace and line breaks for full content */
            word-wrap: break-word;
        }
        .markdown-rendered h1 { font-size: 2em; margin-top: 0.67em; margin-bottom: 0.67em; font-weight: bold; }
        .markdown-rendered strong { font-weight: bold; }
        .markdown-rendered em { font-style: italic; }

        .vision-board-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minminmax(80px, 1fr));
            gap: 8px;
            padding: 8px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            min-height: 100px;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .vision-board-image-item {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
        }
        .vision-board-image-item:hover {
            opacity: 0.8;
        }

        /* --- Theme Styles --- */
        body.theme-light {
            background-color: #f3f4f6;
            color: #222;
        }
        body.theme-dark {
            background-color: #18181b;
            color: #f3f4f6;
        }
        body.theme-dark .bg-white,
        body.theme-dark .bg-gray-100,
        body.theme-dark .bg-blue-50,
        body.theme-dark .bg-green-50,
        body.theme-dark .bg-purple-50,
        body.theme-dark .bg-yellow-50 {
            background-color: #23272f !important;
            color: #f3f4f6 !important;
        }
        body.theme-dark .text-gray-800,
        body.theme-dark .text-gray-700,
        body.theme-dark .text-gray-600,
        body.theme-dark .text-blue-700,
        body.theme-dark .text-green-700,
        body.theme-dark .text-purple-700,
        body.theme-dark .text-yellow-700 {
            color: #e0e7ef !important;
        }
        body.theme-dark .border-gray-200,
        body.theme-dark .border-blue-200,
        body.theme-dark .border-green-200,
        body.theme-dark .border-purple-200,
        body.theme-dark .border-yellow-200 {
            border-color: #444 !important;
        }
        body.theme-dark .shadow-lg,
        body.theme-dark .shadow-md,
        body.theme-dark .shadow-inner {
            box-shadow: 0 2px 8px #0006 !important;
        }
        body.theme-dark input,
        body.theme-dark select,
        body.theme-dark textarea {
            background-color: #23272f !important;
            color: #f3f4f6 !important;
            border-color: #444 !important;
        }
        body.theme-dark .bg-blue-100 {
            background-color: #2d3748 !important;
        }
        body.theme-dark .bg-gray-200 {
            background-color: #333 !important;
        }
        body.theme-dark .bg-gray-50 {
            background-color: #23272f !important;
        }
        body.theme-dark .bg-green-50 {
            background-color: #233524 !important;
        }
        body.theme-dark .bg-purple-100 {
            background-color: #3b3054 !important;
        }
        body.theme-dark .bg-indigo-100 {
            background-color: #3730a3 !important;
        }
        body.theme-dark .bg-red-100 {
            background-color: #7f1d1d !important;
        }
        body.theme-dark .bg-blue-500 {
            background-color: #2563eb !important;
        }
        body.theme-dark .bg-green-500 {
            background-color: #22c55e !important;
        }
        body.theme-dark .bg-red-500 {
            background-color: #ef4444 !important;
        }
        body.theme-dark .bg-yellow-500 {
            background-color: #eab308 !important;
        }
        body.theme-dark .bg-purple-500 {
            background-color: #a21caf !important;
        }
        body.theme-dark .bg-indigo-500 {
            background-color: #6366f1 !important;
        }
        body.theme-dark .bg-gray-800 {
            background-color: #18181b !important;
        }
        body.theme-dark .text-blue-600,
        body.theme-dark .text-green-600,
        body.theme-dark .text-red-600,
        body.theme-dark .text-purple-600,
        body.theme-dark .text-yellow-600 {
            color: #facc15 !important;
        }
        body.theme-dark .text-green-800,
        body.theme-dark .text-red-800,
        body.theme-dark .text-blue-800,
        body.theme-dark .text-purple-800 {
            color: #facc15 !important;
        }
        body.theme-dark .text-white {
            color: #f3f4f6 !important;
        }
        body.theme-dark .text-black {
            color: #f3f4f6 !important;
        }
        body.theme-dark .border {
            border-color: #444 !important;
        }
        /* Solarized theme */
        body.theme-solarized {
            background-color: #fdf6e3;
            color: #657b83;
        }
        body.theme-solarized .bg-white,
        body.theme-solarized .bg-gray-100,
        body.theme-solarized .bg-blue-50,
        body.theme-solarized .bg-green-50,
        body.theme-solarized .bg-purple-50,
        body.theme-solarized .bg-yellow-50 {
            background-color: #fdf6e3 !important;
            color: #657b83 !important;
        }
        body.theme-solarized .text-gray-800,
        body.theme-solarized .text-gray-700,
        body.theme-solarized .text-gray-600,
        body.theme-solarized .text-blue-700,
        body.theme-solarized .text-green-700,
        body.theme-solarized .text-purple-700,
        body.theme-solarized .text-yellow-700 {
            color: #586e75 !important;
        }
        body.theme-solarized .border-gray-200,
        body.theme-solarized .border-blue-200,
        body.theme-solarized .border-green-200,
        body.theme-solarized .border-purple-200,
        body.theme-solarized .border-yellow-200 {
            border-color: #eee8d5 !important;
        }
        body.theme-solarized .shadow-lg,
        body.theme-solarized .shadow-md,
        body.theme-solarized .shadow-inner {
            box-shadow: 0 2px 8px #b5890055 !important;
        }
        body.theme-solarized input,
        body.theme-solarized select,
        body.theme-solarized textarea {
            background-color: #fdf6e3 !important;
            color: #657b83 !important;
            border-color: #eee8d5 !important;
        }

        /* --- Animations & Transitions --- */
        .fade-in {
            opacity: 0;
            animation: fadeInAnim 0.5s forwards;
        }
        @keyframes fadeInAnim {
            to { opacity: 1; }
        }
        .fade-out {
            opacity: 1;
            animation: fadeOutAnim 0.4s forwards;
        }
        @keyframes fadeOutAnim {
            to { opacity: 0; }
        }
        .loading-spinner {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col theme-light">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 flex flex-col items-center">
            <div class="loading-spinner mb-3"></div>
            <div class="text-gray-700 font-semibold">Loading, please wait...</div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 shadow-lg rounded-b-lg">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-3xl font-bold flex items-center">
                <span class="mr-3 text-blue-200" style="font-size:1.5em;">🦢</span> The Smart Swan
            </h1>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="#" id="nav-dashboard" class="nav-link text-lg font-medium hover:text-blue-200 transition-colors duration-200">Dashboard</a></li>
                    <li><a href="#" id="nav-tasks" class="nav-link text-lg font-medium hover:text-blue-200 transition-colors duration-200">Tasks</a></li>
                    <li><a href="#" id="nav-budget" class="nav-link text-lg font-medium hover:text-blue-200 transition-colors duration-200">Budget</a></li>
                    <li><a href="#" id="nav-notes" class="nav-link text-lg font-medium hover:text-blue-200 transition-colors duration-200">Notes</a></li>
                    <li><a href="#" id="nav-goals" class="nav-link text-lg font-medium hover:text-blue-200 transition-colors duration-200">Goals</a></li>
                </ul>
            </nav>
            <!-- Theme Switcher & Data Tools -->
            <div class="flex items-center space-x-3 ml-6">
                <select id="theme-switcher" class="p-2 rounded-md border border-gray-300 text-gray-800 text-sm focus:ring-blue-500 focus:border-blue-500" title="Theme">
                    <option value="light">☀️ Light</option>
                    <option value="dark">🌙 Dark</option>
                    <option value="solarized">🌅 Solarized</option>
                </select>
                <button id="export-data-btn" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm" title="Export Data"><i class="fas fa-download"></i></button>
                <label for="import-data-input" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm cursor-pointer" title="Import Data"><i class="fas fa-upload"></i>
                    <input type="file" id="import-data-input" accept="application/json" class="hidden">
                </label>
                <button id="share-summary-btn" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 text-sm" title="Share Summary"><i class="fas fa-share-alt"></i></button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 p-6 md:p-8 container mx-auto">

        <!-- Dashboard View -->
        <section id="dashboard-view" class="module-view bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-home mr-3 text-indigo-500"></i> Dashboard Overview
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Upcoming Tasks Summary -->
                <div class="bg-blue-50 p-5 rounded-lg shadow-md border border-blue-200">
                    <h3 class="text-xl font-medium text-blue-700 mb-3 flex items-center"><i class="fas fa-clipboard-list mr-2"></i> Upcoming Tasks</h3>
                    <p id="dashboard-tasks-summary" class="text-gray-700 text-lg">No upcoming tasks.</p>
                </div>

                <!-- Task Statistics Summary -->
                <div class="bg-blue-50 p-5 rounded-lg shadow-md border border-blue-200">
                    <h3 class="text-xl font-medium text-blue-700 mb-3 flex items-center"><i class="fas fa-chart-line mr-2"></i> Task Statistics</h3>
                    <p id="dashboard-task-stats" class="text-gray-700 text-lg">Total: 0, Completed: 0, Overdue: 0</p>
                </div>

                <!-- Budget Overview Summary -->
                <div class="bg-green-50 p-5 rounded-lg shadow-md border border-green-200">
                    <h3 class="text-xl font-medium text-green-700 mb-3 flex items-center"><i class="fas fa-wallet mr-2"></i> Budget Overview</h3>
                    <p id="dashboard-budget-summary" class="text-gray-700 text-lg">No budget data.</p>
                </div>

                <!-- Money Left in Kitty -->
                <div class="bg-green-50 p-5 rounded-lg shadow-md border border-green-200">
                    <h3 class="text-xl font-medium text-green-700 mb-3 flex items-center"><i class="fas fa-piggy-bank mr-2"></i> Money Left This Month</h3>
                    <p id="dashboard-money-left" class="text-gray-700 text-lg font-bold text-green-800">$0.00</p>
                </div>

                <!-- Recent Notes Summary -->
                <div class="bg-purple-50 p-5 rounded-lg shadow-md border border-purple-200">
                    <h3 class="text-xl font-medium text-purple-700 mb-3 flex items-center"><i class="fas fa-sticky-note mr-2"></i> Recent Notes</h3>
                    <p id="dashboard-notes-summary" class="text-gray-700 text-lg">No recent notes.</p>
                </div>

                <!-- Daily Recommendations -->
                <div class="bg-yellow-50 p-5 rounded-lg shadow-md border border-yellow-200">
                    <h3 class="text-xl font-medium text-yellow-700 mb-3 flex items-center"><i class="fas fa-lightbulb mr-2"></i> Daily Recommendation</h3>
                    <p id="dashboard-recommendation" class="text-gray-700 text-lg">"Take a short walk to clear your mind!"</p>
                </div>
            </div>
        </section>

        <!-- Task Management View -->
        <section id="tasks-view" class="module-view hidden bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-tasks mr-3 text-blue-500"></i> Task Management
            </h2>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Add New Task</h3>
                    <div class="bg-gray-100 p-5 rounded-lg shadow-inner">
                        <!-- Main Category -->
                        <div class="mb-3">
                            <label for="task-main-category-select" class="block text-gray-700 text-sm font-bold mb-2">Main Category:</label>
                            <select id="task-main-category-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="">-- Select Main Category --</option>
                                <option value="Work/Productivity">Work/Productivity 💼</option>
                                <option value="Personal/Home">Personal/Home 🏠</option>
                                <option value="Creative/Hobbies">Creative/Hobbies 🎨</option>
                            </select>
                        </div>

                        <!-- Sub Category (dynamically loaded) -->
                        <div class="mb-3">
                            <label for="task-sub-category-select" class="block text-gray-700 text-sm font-bold mb-2">Sub-Category:</label>
                            <select id="task-sub-category-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" disabled>
                                <option value="">-- Select Sub-Category --</option>
                            </select>
                        </div>

                        <!-- Specific Description -->
                        <div class="mb-3">
                            <label for="task-description-input" class="block text-gray-700 text-sm font-bold mb-2">Specific Description:</label>
                            <input type="text" id="task-description-input" placeholder="e.g., 'Draft project report', 'Water plants'" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <input type="date" id="task-date-input" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">

                        <!-- Priority -->
                        <select id="task-priority-select" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="Low">Low Priority</option>
                            <option value="Medium">Medium Priority</option>
                            <option value="High">High Priority</option>
                            <option value="Urgent">Urgent Priority</option>
                        </select>

                        <!-- Recurring Task Options -->
                        <div class="flex items-center mb-3">
                            <input type="checkbox" id="task-recurring-checkbox" class="mr-2 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="task-recurring-checkbox" class="text-gray-700">Recurring Task</label>
                        </div>
                        <div id="recurring-options" class="hidden mb-3 p-3 bg-gray-50 rounded-md border border-gray-200">
                            <label for="task-recurrence-frequency" class="block text-gray-700 text-sm font-bold mb-2">Frequency:</label>
                            <select id="task-recurrence-frequency" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="fortnightly">Fortnightly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                            <div class="flex items-center">
                                <input type="checkbox" id="task-exclude-weekends-checkbox" class="mr-2 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="task-exclude-weekends-checkbox" class="text-gray-700">Exclude Weekends</label>
                            </div>
                        </div>

                        <!-- Task Dependency -->
                        <div class="mb-4">
                            <label for="task-dependency-select" class="block text-gray-700 text-sm font-bold mb-2">Depends on Task (optional):</label>
                            <select id="task-dependency-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="">-- No Dependency --</option>
                                <!-- Tasks will be dynamically loaded here -->
                            </select>
                        </div>

                        <button id="add-task-btn" class="w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition-colors duration-200 font-semibold shadow-md">Add Task</button>
                    </div>
                </div>
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Your Tasks</h3>
                    <ul id="tasks-list" class="space-y-3">
                        <!-- Tasks will be dynamically loaded here -->
                        <li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200">
                            <span>No tasks added yet.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Budget Tracking View -->
        <section id="budget-view" class="module-view hidden bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-chart-pie mr-3 text-green-500"></i> Budget Tracking
            </h2>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Add Transaction</h3>
                    <div class="bg-gray-100 p-5 rounded-lg shadow-inner mb-6">
                        <div class="mb-3">
                            <label for="transaction-main-category-select" class="block text-gray-700 text-sm font-bold mb-2">Main Category:</label>
                            <select id="transaction-main-category-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                                <option value="">-- Select Main Category --</option>
                                <option value="Income">Income</option>
                                <option value="Expense">Expense</option>
                                <option value="Savings">Savings</option>
                                <option value="Invest">Invest</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="transaction-sub-category-select" class="block text-gray-700 text-sm font-bold mb-2">Sub-Category:</label>
                            <select id="transaction-sub-category-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500" disabled>
                                <option value="">-- Select Sub-Category --</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="new-sub-category-input" class="block text-gray-700 text-sm font-bold mb-2">Add New Sub-Category (Optional):</label>
                            <input type="text" id="new-sub-category-input" placeholder="e.g., 'Coffee', 'New Stock'" class="w-full p-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                            <button id="add-new-sub-category-btn" class="mt-2 w-full bg-gray-400 text-white py-2 rounded-md hover:bg-gray-500 transition-colors duration-200 text-sm">Add Custom Sub-Category</button>
                        </div>

                        <input type="text" id="transaction-description-input" placeholder="Description (e.g., 'Monthly Salary')" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        <input type="number" id="transaction-amount-input" placeholder="Amount (e.g., 500.00)" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        <input type="date" id="transaction-date-input" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        <button id="add-transaction-btn" class="w-full bg-green-600 text-white py-3 rounded-md hover:bg-green-700 transition-colors duration-200 font-semibold shadow-md">Add Transaction</button>
                    </div>

                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Set Monthly Budget Goals</h3>
                    <div class="bg-gray-100 p-5 rounded-lg shadow-inner">
                        <div class="mb-3">
                            <label for="budget-goal-subcategory-select" class="block text-gray-700 text-sm font-bold mb-2">Sub-Category for Goal:</label>
                            <select id="budget-goal-subcategory-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                                <option value="">-- Select Sub-Category --</option>
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <input type="number" id="budget-goal-amount-input" placeholder="Monthly Goal Amount" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        <button id="set-budget-goal-btn" class="w-full bg-indigo-600 text-white py-3 rounded-md hover:bg-indigo-700 transition-colors duration-200 font-semibold shadow-md">Set Goal</button>
                    </div>
                </div>

                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Your Transactions</h3>
                    <div class="bg-blue-100 p-4 rounded-lg shadow-md mb-4 text-blue-800 font-semibold flex justify-between items-center">
                        <span>Current Balance: <span id="current-balance">$0.00</span></span>
                        <span>Money Left This Month: <span id="money-left-this-month" class="font-bold text-green-800">$0.00</span></span>
                    </div>
                    <ul id="transactions-list" class="space-y-3 mb-6">
                        <!-- Transactions will be dynamically loaded here -->
                        <li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200">
                            <span>No transactions added yet.</span>
                        </li>
                    </ul>

                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Monthly Budget Goals Progress</h3>
                    <ul id="budget-goals-list" class="space-y-3 mb-6">
                        <!-- Budget goals and progress will be dynamically loaded here -->
                        <li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200">
                            <span>No budget goals set yet.</span>
                        </li>
                    </ul>

                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Spending Insights (Current Month)</h3>
                    <div class="bg-gray-100 p-5 rounded-lg shadow-inner mb-6">
                        <canvas id="spendingChart" class="w-full h-64"></canvas>
                        <div id="spending-insights-text" class="text-gray-700 mt-4">
                            <!-- Spending breakdown text will be here -->
                            <p>No spending data for this month.</p>
                        </div>
                    </div>

                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Spending Recommendations</h3>
                    <div class="bg-yellow-50 p-5 rounded-lg shadow-md border border-yellow-200" id="spending-recommendation-output">
                        <p>No recommendations yet. Start tracking your spending!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Note-Taking View -->
        <section id="notes-view" class="module-view hidden bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-edit mr-3 text-purple-500"></i> Notes: Your Brain Dump Space 🧠
            </h2>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Add New Note</h3>
                    <div class="bg-gray-100 p-5 rounded-lg shadow-inner">
                        <!-- Note Templates -->
                        <div class="mb-3">
                            <label for="note-template-select" class="block text-gray-700 text-sm font-bold mb-2">Use Template:</label>
                            <select id="note-template-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                                <option value="">-- Select a template --</option>
                                <option value="Meeting Minutes">Meeting Minutes 📝</option>
                                <option value="Idea Brainstorm">Idea Brainstorm 💡</option>
                                <option value="Daily Journal">Daily Journal ✍️</option>
                                <option value="Quick Thought">Quick Thought 🤔</option>
                            </select>
                        </div>
                        <input type="text" id="note-title-input" placeholder="Note Title" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                        <textarea id="note-content-input" placeholder="Note content... (basic markdown supported: **bold**, *italic*, # Heading)" rows="8" class="w-full p-3 mb-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"></textarea>

                        <div class="mb-3">
                            <label for="note-category-input" class="block text-gray-700 text-sm font-bold mb-2">Category:</label>
                            <select id="note-category-input" class="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                                <option value="">-- Select Category --</option>
                                <option value="Idea">Idea</option>
                                <option value="Meeting">Meeting</option>
                                <option value="Journal">Journal</option>
                                <option value="Reference">Reference</option>
                                <option value="Random">Random</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="note-tags-input" class="block text-gray-700 text-sm font-bold mb-2">Tags (comma separated):</label>
                            <input type="text" id="note-tags-input" placeholder="e.g., work, projectA, important" class="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                        </div>

                        <div class="mb-4">
                            <label for="note-color-input" class="block text-gray-700 text-sm font-bold mb-2">Note Color:</label>
                            <input type="color" id="note-color-input" value="#ffffff" class="w-full h-10 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500 cursor-pointer">
                        </div>

                        <button id="add-note-btn" class="w-full bg-purple-600 text-white py-3 rounded-md hover:bg-purple-700 transition-colors duration-200 font-semibold shadow-md">Add Note</button>
                    </div>
                </div>
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Your Notes</h3>
                    <input type="text" id="note-search-input" placeholder="Search notes..." class="w-full p-3 mb-4 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                    <ul id="notes-list" class="space-y-3">
                        <!-- Notes will be dynamically loaded here -->
                        <li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200">
                            <span>No notes added yet.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Goal Setting View -->
        <section id="goals-view" class="module-view hidden bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-bullseye mr-3 text-yellow-500"></i> Goal Setting
            </h2>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Create New Goal</h3>
                    <div class="bg-gray-100 p-5 rounded-lg shadow-inner">
                        <!-- Goal Category -->
                        <div class="mb-3">
                            <label for="goal-category-select" class="block text-gray-700 text-sm font-bold mb-2">Category:</label>
                            <select id="goal-category-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500">
                                <option value="">-- Select Category --</option>
                                <option value="Career & Learning">Career & Learning 📈</option>
                                <option value="Health & Wellness">Health & Wellness ❤️</option>
                                <option value="Financial">Financial 💰</option>
                                <option value="Personal Growth">Personal Growth 🌱</option>
                                <option value="Relationships">Relationships 🤝</option>
                                <option value="Creative Projects">Creative Projects 🎨</option>
                                <option value="Adventure & Fun">Adventure & Fun 🌍</option>
                                <option value="Contribution">Contribution ✨</option>
                            </select>
                        </div>

                        <!-- SMART Fields -->
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">SMART Goal Details:</h4>
                        <div class="mb-3">
                            <label for="goal-specific-input" class="block text-gray-700 text-sm font-bold mb-2">Specific Goal:</label>
                            <input type="text" id="goal-specific-input" placeholder="e.g., 'Run a full marathon'" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500">
                        </div>
                        <div class="mb-3 grid grid-cols-2 gap-3">
                            <div>
                                <label for="goal-measurable-metric-input" class="block text-gray-700 text-sm font-bold mb-2">Measurable Metric:</label>
                                <input type="text" id="goal-measurable-metric-input" placeholder="e.g., 'distance in km', 'books read'" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500">
                            </div>
                            <div>
                                <label for="goal-measurable-target-input" class="block text-gray-700 text-sm font-bold mb-2">Target Value:</label>
                                <input type="number" id="goal-measurable-target-input" placeholder="e.g., '42.195', '10'" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="goal-current-progress-input" class="block text-gray-700 text-sm font-bold mb-2">Current Progress Value:</label>
                            <input type="number" id="goal-current-progress-input" placeholder="e.g., '0', '2'" value="0" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500">
                        </div>
                        <div class="mb-3">
                            <label for="goal-achievable-input" class="block text-gray-700 text-sm font-bold mb-2">Achievable Steps:</label>
                            <textarea id="goal-achievable-input" placeholder="Outline steps to achieve this goal..." rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="goal-why-matters-input" class="block text-gray-700 text-sm font-bold mb-2">Why This Matters (Relevant):</label>
                            <textarea id="goal-why-matters-input" placeholder="Why is this goal important to you?" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500"></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="goal-target-date-input" class="block text-gray-700 text-sm font-bold mb-2">Deadline (Time-bound):</label>
                            <input type="date" id="goal-target-date-input" class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500">
                        </div>

                        <!-- Vision Board -->
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Vision Board:</label>
                            <input type="file" id="goal-vision-board-upload" accept="image/*" multiple class="w-full p-2 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500">
                            <div id="vision-board-preview" class="vision-board-preview-container mt-2">
                                <p class="text-gray-500 text-sm">Upload images for your vision board.</p>
                            </div>
                        </div>

                        <!-- Linked Notes and Tasks -->
                        <div class="mb-3">
                            <label for="goal-link-notes-select" class="block text-gray-700 text-sm font-bold mb-2">Link Notes (Optional):</label>
                            <select id="goal-link-notes-select" multiple class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500 h-24">
                                <!-- Notes loaded dynamically -->
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="goal-link-tasks-select" class="block text-gray-700 text-sm font-bold mb-2">Link Tasks (Optional):</label>
                            <select id="goal-link-tasks-select" multiple class="w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500 h-24">
                                <!-- Tasks loaded dynamically -->
                            </select>
                        </div>

                        <button id="add-goal-btn" class="w-full bg-yellow-600 text-white py-3 rounded-md hover:bg-yellow-700 transition-colors duration-200 font-semibold shadow-md">Create Goal</button>
                    </div>
                </div>
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-medium text-gray-700 mb-4">Your Goals</h3>
                    <!-- Filter/Sort Controls -->
                    <div class="flex flex-wrap gap-4 mb-4">
                        <div class="flex-1 min-w-[150px]">
                            <label for="goal-filter-category" class="block text-gray-700 text-sm font-bold mb-1">Filter by Category:</label>
                            <select id="goal-filter-category" class="w-full p-2 border border-gray-300 rounded-md">
                                <option value="">All Categories</option>
                                <option value="Career & Learning">Career & Learning</option>
                                <option value="Health & Wellness">Health & Wellness</option>
                                <option value="Financial">Financial</option>
                                <option value="Personal Growth">Personal Growth</option>
                                <option value="Relationships">Relationships</option>
                                <option value="Creative Projects">Creative Projects</option>
                                <option value="Adventure & Fun">Adventure & Fun</option>
                                <option value="Contribution">Contribution</option>
                            </select>
                        </div>
                        <div class="flex-1 min-w-[150px]">
                            <label for="goal-sort-by" class="block text-gray-700 text-sm font-bold mb-1">Sort By:</label>
                            <select id="goal-sort-by" class="w-full p-2 border border-gray-300 rounded-md">
                                <option value="deadline-asc">Deadline (Soonest First)</option>
                                <option value="deadline-desc">Deadline (Latest First)</option>
                                <option value="created-asc">Created Date (Oldest First)</option>
                                <option value="created-desc">Created Date (Newest First)</option>
                            </select>
                        </div>
                    </div>

                    <ul id="goals-list" class="space-y-3">
                        <!-- Goals will be dynamically loaded here -->
                        <li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200">
                            <span>No goals added yet.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-4 text-center rounded-t-lg shadow-inner">
        <p>&copy; 2025 The Smart Swan 🦢. All rights reserved.</p>
    </footer>

    <!-- Share Summary Modal -->
    <div id="share-summary-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 max-w-xl w-full relative">
            <button id="close-share-summary-modal" class="absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl">&times;</button>
            <h3 class="text-xl font-bold mb-4">Shareable Summary</h3>
            <textarea id="share-summary-textarea" class="w-full h-64 p-3 border border-gray-300 rounded-md mb-3" readonly></textarea>
            <button id="copy-share-summary-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Copy to Clipboard</button>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements (move these to the top so all functions can use them) ---
    const themeSwitcher = document.getElementById('theme-switcher');
    const exportDataBtn = document.getElementById('export-data-btn');
    const importDataInput = document.getElementById('import-data-input');
    const shareSummaryBtn = document.getElementById('share-summary-btn');
    const shareSummaryModal = document.getElementById('share-summary-modal');
    const shareSummaryTextarea = document.getElementById('share-summary-textarea');
    const closeShareSummaryModal = document.getElementById('close-share-summary-modal');
    const copyShareSummaryBtn = document.getElementById('copy-share-summary-btn');

    const dashboardView = document.getElementById('dashboard-view');
    const tasksView = document.getElementById('tasks-view');
    const budgetView = document.getElementById('budget-view');
    const notesView = document.getElementById('notes-view');
    const goalsView = document.getElementById('goals-view');

    // --- LocalStorage Data Schema & Migration ---

    // Versioned schema for future-proofing
    const STORAGE_VERSION = 1;
    const STORAGE_KEY = 'personalAssistantAppData';

    // Efficient data schema
    const defaultAppData = {
        version: STORAGE_VERSION,
        tasks: [],
        transactions: [],
        notes: [],
        goals: [],
        budgetGoals: {},
        customBudgetCategories: {
            "Income": [],
            "Expense": [],
            "Savings": [],
            "Invest": []
        }
    };

    // Data migration for future updates
    function migrateAppData(data) {
        let migrated = false;
        // Example: If version is missing or less than STORAGE_VERSION, migrate
        if (!data.version || data.version < STORAGE_VERSION) {
            // Add new fields or transform as needed for future versions
            // (No migrations needed for version 1, but structure is ready)
            data.version = STORAGE_VERSION;
            migrated = true;
        }
        return migrated ? data : data;
    }

    // Load and validate app data from localStorage
    function loadAppData() {
        let data;
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return { ...defaultAppData };
            data = JSON.parse(raw);

            // Validate structure
            if (
                typeof data !== 'object' ||
                !Array.isArray(data.tasks) ||
                !Array.isArray(data.transactions) ||
                !Array.isArray(data.notes) ||
                !Array.isArray(data.goals) ||
                typeof data.budgetGoals !== 'object' ||
                typeof data.customBudgetCategories !== 'object'
            ) {
                throw new Error('Corrupt or invalid data structure');
            }

            // Migrate if needed
            data = migrateAppData(data);

        } catch (e) {
            alert('App data is corrupted or invalid. Resetting to defaults.');
            data = { ...defaultAppData };
            saveAppData(data);
        }
        return data;
    }

    // Save app data to localStorage
    function saveAppData(data) {
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        } catch (e) {
            alert('Failed to save data: ' + e.message);
        }
    }

    // --- Replace all direct localStorage usage with appData object ---
    let appData = loadAppData();

    // Example: Access tasks as appData.tasks, etc.
    // When updating, call saveAppData(appData);

    // --- Update all get/set functions for export/import/validation ---

    function getAllAppData() {
        return { ...appData };
    }
    function validateAppData(data) {
        try {
            if (
                typeof data !== 'object' ||
                !Array.isArray(data.tasks) ||
                !Array.isArray(data.transactions) ||
                !Array.isArray(data.notes) ||
                !Array.isArray(data.goals) ||
                typeof data.budgetGoals !== 'object' ||
                typeof data.customBudgetCategories !== 'object'
            ) {
                return false;
            }
            return true;
        } catch {
            return false;
        }
    }

    // --- Update Export/Import to use new schema ---
    exportDataBtn.addEventListener('click', () => {
        const data = getAllAppData();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'personal-assistant-data.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });

    importDataInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const data = JSON.parse(event.target.result);
                if (!validateAppData(data)) {
                    alert('Invalid data format. Import failed.');
                    return;
                }
                // Migrate if needed
                appData = migrateAppData(data);
                saveAppData(appData);
                alert('Data imported successfully! The page will now reload.');
                location.reload();
            } catch (err) {
                alert('Failed to import data: ' + err.message);
            }
        };
        reader.readAsText(file);
    });

    // --- Update all CRUD operations to use appData and saveAppData(appData) ---
    // Example for tasks:
    function addTask() {
        // ...existing code to build newTask...
        appData.tasks.push(newTask);
        saveAppData(appData);
        // ...existing code...
    }
    // Similarly update addTransaction, addNote, addGoal, and all delete/edit operations to use appData and saveAppData(appData)

    // --- Use appData for rendering and dashboard updates ---
    // Example:
    function updateDashboard() {
        // ...use appData.tasks, appData.notes, etc...
    }

    // --- Theme Customization ---
    const themeClassMap = {
        light: 'theme-light',
        dark: 'theme-dark',
        solarized: 'theme-solarized'
    };
    function applyTheme(theme) {
        document.body.classList.remove('theme-light', 'theme-dark', 'theme-solarized');
        document.body.classList.add(themeClassMap[theme] || 'theme-light');
        themeSwitcher.value = theme;
    }
    function saveTheme(theme) {
        localStorage.setItem('personalAssistantTheme', theme);
    }
    function loadTheme() {
        const savedTheme = localStorage.getItem('personalAssistantTheme') || 'light';
        applyTheme(savedTheme);
    }
    themeSwitcher.addEventListener('change', (e) => {
        const theme = e.target.value;
        applyTheme(theme);
        saveTheme(theme);
    });
    loadTheme();

    // --- Navigation Event Listeners (fix: must be after DOM elements and showView definition) ---
    function showView(viewToShow) {
        const allViews = document.querySelectorAll('.module-view');
        allViews.forEach(view => view.classList.add('hidden'));
        viewToShow.classList.remove('hidden');
        fadeInView(viewToShow);
        // Update nav link styling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('text-blue-200', 'font-bold', 'underline');
            link.classList.add('text-white', 'font-medium');
        });
        const activeNavLinkId = `nav-${viewToShow.id.replace('-view', '')}`;
        const activeNavLink = document.getElementById(activeNavLinkId);
        if (activeNavLink) {
            activeNavLink.classList.remove('text-white', 'font-medium');
            activeNavLink.classList.add('text-blue-200', 'font-bold', 'underline');
        }
    }

    document.getElementById('nav-dashboard').addEventListener('click', (e) => {
        e.preventDefault();
        showView(dashboardView);
    });
    document.getElementById('nav-tasks').addEventListener('click', (e) => {
        e.preventDefault();
        showView(tasksView);
    });
    document.getElementById('nav-budget').addEventListener('click', (e) => {
        e.preventDefault();
        showView(budgetView);
    });
    document.getElementById('nav-notes').addEventListener('click', (e) => {
        e.preventDefault();
        showView(notesView);
    });
    document.getElementById('nav-goals').addEventListener('click', (e) => {
        e.preventDefault();
        showView(goalsView);
    });

    // Show dashboard by default
    showView(dashboardView);

    // --- Export/Import/Share Summary (fix: use appData for export/import, and ensure only one handler per button) ---
    exportDataBtn.addEventListener('click', () => {
        showLoading("Exporting data...");
        setTimeout(() => {
            const data = getAllAppData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'personal-assistant-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            hideLoading();
        }, 500);
    });

    importDataInput.addEventListener('change', (e) => {
        showLoading("Importing data...");
        const file = e.target.files[0];
        if (!file) { hideLoading(); return; }
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const data = JSON.parse(event.target.result);
                if (!validateAppData(data)) {
                    alert('Invalid data format. Import failed.');
                    hideLoading();
                    return;
                }
                // Save to new schema
                saveAppData(data);
                setTimeout(() => {
                    hideLoading();
                    alert('Data imported successfully! The page will now reload.');
                    location.reload();
                }, 500);
            } catch (err) {
                hideLoading();
                alert('Failed to import data: ' + err.message);
            }
        };
        reader.readAsText(file);
    });

    shareSummaryBtn.addEventListener('click', () => {
        const data = getAllAppData();
        let summary = '';
        summary += `=== Tasks (${data.tasks.length}) ===\n`;
        data.tasks.forEach(t => {
            summary += `- [${t.completed ? 'x' : ' '}] ${t.fullDescription || t.description} (Due: ${t.date}, Priority: ${t.priority})\n`;
        });
        summary += `\n=== Notes (${data.notes.length}) ===\n`;
        data.notes.forEach(n => {
            summary += `- ${n.title} (${n.category || 'General'})\n`;
        });
        summary += `\n=== Transactions (${data.transactions.length}) ===\n`;
        data.transactions.forEach(tr => {
            summary += `- ${tr.mainCategory}/${tr.subCategory}: $${tr.amount} (${tr.description}, ${tr.date})\n`;
        });
        summary += `\n=== Goals (${data.goals.length}) ===\n`;
        data.goals.forEach(g => {
            summary += `- ${g.specific} [${g.category}] Progress: ${g.currentProgress}/${g.measurableTarget} (${g.measurableMetric}) Deadline: ${g.targetDate}\n`;
        });
        summary += `\n=== Budget Goals ===\n`;
        Object.keys(data.budgetGoals).forEach(month => {
            summary += `- ${month}:\n`;
            Object.keys(data.budgetGoals[month]).forEach(subcat => {
                summary += `   • ${subcat}: $${data.budgetGoals[month][subcat]}\n`;
            });
        });
        shareSummaryTextarea.value = summary;
        shareSummaryModal.classList.remove('hidden');
    });
    closeShareSummaryModal.addEventListener('click', () => {
        shareSummaryModal.classList.add('hidden');
    });
    copyShareSummaryBtn.addEventListener('click', () => {
        shareSummaryTextarea.select();
        document.execCommand('copy');
        copyShareSummaryBtn.textContent = 'Copied!';
        setTimeout(() => { copyShareSummaryBtn.textContent = 'Copy to Clipboard'; }, 1200);
    });

    // --- Task Categories Data ---
    const taskCategories = {
        "Work/Productivity": [
            { name: "Plan", emoji: "📝" },
            { name: "Organize", emoji: "🗄️" },
            { name: "Research", emoji: "🔍" },
            { name: "Write", emoji: "✍️" },
            { name: "Create", emoji: "💡" },
            { name: "Build", emoji: "🛠️" },
            { name: "Fix", emoji: "🔧" },
            { name: "Analyse", emoji: "📊" },
            { name: "Prepare", emoji: "📋" },
            { name: "Present", emoji: "🗣️" },
            { name: "Remember", emoji: "🧠" },
            { name: "Other", emoji: "➡️" }
        ],
        "Personal/Home": [
            { name: "Clean", emoji: "🧹" },
            { name: "Cook", emoji: "🍳" },
            { name: "Buy", emoji: "🛍️" },
            { name: "Shop", emoji: "🛒" },
            { name: "Exercise", emoji: "🏃‍♀️" },
            { name: "Read", emoji: "📖" },
            { name: "Relax", emoji: "🧘" },
            { name: "Study", emoji: "📚" },
            { name: "Meet", emoji: "🤝" },
            { name: "Call", emoji: "📞" },
            { name: "Email", emoji: "📧" },
            { name: "Text", emoji: "📱" }
        ],
        "Creative/Hobbies": [
            { name: "Draw", emoji: "✏️" },
            { name: "Paint", emoji: "🖌️" },
            { name: "Write (creative)", emoji: "✍️" },
            { name: "Play (music/games/sports)", emoji: "🎮" },
            { name: "Garden", emoji: "🪴" },
            { name: "Learn (new skill)", emoji: "🧠" },
            { name: "Listen", emoji: "🎧" }
        ]
    };

    // --- Task Sub-Category Dynamic Loading - REMOVE SUB CATEGORY ---
    const taskMainCategorySelect = document.getElementById('task-main-category-select');

    function loadTaskSubCategories(mainCategory) {
        if (!mainCategory || !taskCategories[mainCategory]) {
            return;
        }
    }

    taskMainCategorySelect.addEventListener('change', (e) => {
        loadTaskSubCategories(e.target.value);
    });

    // --- Budget Sub-Category Dynamic Loading ---
    const transactionMainCategorySelect = document.getElementById('transaction-main-category-select');

    function getAllBudgetCategories() {
        const predefinedCategories = {
            "Income": [
                { "name": "Salary", "emoji": "💼" },
                { "name": "Business", "emoji": "🏢" },
                { "name": "Investments", "emoji": "📈" }
            ],
            "Expense": [
                { "name": "Rent", "emoji": "🏠" },
                { "name": "Utilities", "emoji": "💡" },
                { "name": "Groceries", "emoji": "🥦" },
                { "name": "Transportation", "emoji": "🚗" },
                { "name": "Entertainment", "emoji": "🎉" },
                { "name": "Healthcare", "emoji": "⚕️" },
                { "name": "Insurance", "emoji": "🛡️" },
                { "name": "Education", "emoji": "🎓" },
                { "name": "Clothing", "emoji": "👗" },
                { "name": "Personal Care", "emoji": "🧴" },
                { "name": "Miscellaneous", "emoji": "📦" }
            ],
            "Savings": [
                { "name": "Emergency Fund", "emoji": "🚑" },
                { "name": "Retirement", "emoji": "🏖️" },
                { "name": "Vacation", "emoji": "✈️" },
                { "name": "Major Purchase", "emoji": "🏠" }
            ],
            "Invest": [
                { "name": "Stocks", "emoji": "📈" },
                { "name": "Bonds", "emoji": "📉" },
                { "name": "Real Estate", "emoji": "🏢" },
                { "name": "Cryptocurrency", "emoji": "₿" }
            ]
        };
        return predefinedCategories;
    }

    function loadBudgetSubCategories(mainCategory) {
        if (!mainCategory) {
            return;
        }
    }

    transactionMainCategorySelect.addEventListener('change', (e) => {
        loadBudgetSubCategories(e.target.value);
    });

    // --- Add Task Functionality ---
    const addTaskBtn = document.getElementById('add-task-btn');
    addTaskBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const mainCategory = taskMainCategorySelect.value;
        const description = document.getElementById('task-description-input').value.trim();
        const date = document.getElementById('task-date-input').value;
        const priority = document.getElementById('task-priority-select').value;

        if (!mainCategory || !description || !date) {
            alert('Please fill in all required fields.');
            return;
        }

        const newTask = {
            id: Date.now(), // Simplified ID generation
            mainCategory,
            description,
            date,
            priority
        };

        try {
            appData.tasks.push(newTask);
            saveAppData(appData);
            renderTasks();
            updateDashboard();
        } catch (error) {
            console.error("Error adding task:", error);
        }

        // Reset form
        taskMainCategorySelect.value = '';
        loadTaskSubCategories('');
        document.getElementById('task-description-input').value = '';
        document.getElementById('task-date-input').value = '';
        document.getElementById('task-priority-select').value = 'Low';
    });

    // --- Add Transaction Functionality ---
    const addTransactionBtn = document.getElementById('add-transaction-btn');
    addTransactionBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const mainCategory = transactionMainCategorySelect.value;
        const description = document.getElementById('transaction-description-input').value.trim();
        const amount = parseFloat(document.getElementById('transaction-amount-input').value);
        const date = document.getElementById('transaction-date-input').value;

        if (!mainCategory || isNaN(amount) || !date) {
            alert('Please fill in all required fields.');
            return;
        }

        const newTransaction = {
            id: Date.now(), // Simplified ID generation
            mainCategory,
            description,
            amount: amount.toFixed(2),
            date
        };

        try {
            appData.transactions.push(newTransaction);
            saveAppData(appData);
            renderTransactions();
            updateDashboard();
        } catch (error) {
            console.error("Error adding transaction:", error);
        }

        // Reset form
        transactionMainCategorySelect.value = '';
        loadBudgetSubCategories('');
        document.getElementById('transaction-description-input').value = '';
        document.getElementById('transaction-amount-input').value = '';
        document.getElementById('transaction-date-input').value = '';
    });

    // --- Add Note Functionality ---
    const addNoteBtn = document.getElementById('add-note-btn');
    addNoteBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const title = document.getElementById('note-title-input').value.trim();
        const content = document.getElementById('note-content-input').value.trim();
        const category = document.getElementById('note-category-input').value;

        if (!title || !content) {
            alert('Please fill in all required fields.');
            return;
        }

        const newNote = {
            id: Date.now(), // Simplified ID generation
            title,
            content,
            category
        };

        try {
            appData.notes.push(newNote);
            saveAppData(appData);
            renderNotes();
            updateDashboard();
        } catch (error) {
            console.error("Error adding note:", error);
        }

        // Reset form
        document.getElementById('note-title-input').value = '';
        document.getElementById('note-content-input').value = '';
        document.getElementById('note-category-input').value = '';
    });

    // --- Add Goal Functionality ---
    const addGoalBtn = document.getElementById('add-goal-btn');
    addGoalBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const category = document.getElementById('goal-category-select').value;
        const specific = document.getElementById('goal-specific-input').value.trim();
        const measurableMetric = document.getElementById('goal-measurable-metric-input').value.trim();
        const measurableTarget = parseFloat(document.getElementById('goal-measurable-target-input').value);
        const currentProgress = parseFloat(document.getElementById('goal-current-progress-input').value);
        const targetDate = document.getElementById('goal-target-date-input').value;

        if (!category || !specific || !measurableMetric || isNaN(measurableTarget) || isNaN(currentProgress) || !targetDate) {
            alert('Please fill in all required fields.');
            return;
        }

        const newGoal = {
            id: Date.now(), // Simplified ID generation
            category,
            specific,
            measurableMetric,
            measurableTarget,
            currentProgress,
            targetDate
        };

        try {
            appData.goals.push(newGoal);
            saveAppData(appData);
            renderGoals();
            updateDashboard();
        } catch (error) {
            console.error("Error adding goal:", error);
        }

        // Reset form
        document.getElementById('goal-category-select').value = '';
        document.getElementById('goal-specific-input').value = '';
        document.getElementById('goal-measurable-metric-input').value = '';
        document.getElementById('goal-measurable-target-input').value = '';
        document.getElementById('goal-current-progress-input').value = '0';
        document.getElementById('goal-target-date-input').value = '';
    });

    // --- Render Functions (already defined) ---
    function renderTasks() {
        const tasksList = document.getElementById('tasks-list');
        tasksList.innerHTML = ''; // Clear existing list

        if (!appData.tasks || appData.tasks.length === 0) {
            tasksList.innerHTML = '<li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200"><span>No tasks added yet.</span></li>';
            return;
        }

        appData.tasks.forEach(task => {
            const listItem = document.createElement('li');
            listItem.className = 'bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200';
            listItem.innerHTML = `
                <span>${task.description} (${task.mainCategory}) - ${task.date} - ${task.priority}</span>
                <div>
                    <button class="text-blue-500 hover:text-blue-700"><i class="fas fa-edit"></i></button>
                    <button class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                </div>
            `;
            try {
                tasksList.appendChild(listItem);
            } catch (error) {
                console.error("Error appending task list item:", error);
            }
        });
    }

    function renderTransactions() {
        const transactionsList = document.getElementById('transactions-list');
        transactionsList.innerHTML = '';

        if (!appData.transactions || appData.transactions.length === 0) {
            transactionsList.innerHTML = '<li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200"><span>No transactions added yet.</span></li>';
            return;
        }

        appData.transactions.forEach(transaction => {
            const listItem = document.createElement('li');
            listItem.className = 'bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200';
            listItem.innerHTML = `
                <span>${transaction.description} (${transaction.mainCategory}): $${transaction.amount} - ${transaction.date}</span>
                <div>
                    <button class="text-blue-500 hover:text-blue-700"><i class="fas fa-edit"></i></button>
                    <button class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                </div>
            `;
            try {
                transactionsList.appendChild(listItem);
            } catch (error) {
                console.error("Error appending transaction list item:", error);
            }
        });
    }

    function renderNotes() {
        const notesList = document.getElementById('notes-list');
        notesList.innerHTML = '';

        if (!appData.notes || appData.notes.length === 0) {
            notesList.innerHTML = '<li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200"><span>No notes added yet.</span></li>';
            return;
        }

        appData.notes.forEach(note => {
            const listItem = document.createElement('li');
            listItem.className = 'bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200';
            listItem.innerHTML = `
                <span>${note.title} - ${note.content} (${note.category})</span>
                <div>
                    <button class="text-blue-500 hover:text-blue-700"><i class="fas fa-edit"></i></button>
                    <button class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                </div>
            `;
            try {
                notesList.appendChild(listItem);
            } catch (error) {
                console.error("Error appending note list item:", error);
            }
        });
    }

    function renderGoals() {
        const goalsList = document.getElementById('goals-list');
        goalsList.innerHTML = '';

        if (!appData.goals || appData.goals.length === 0) {
            goalsList.innerHTML = '<li class="bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200"><span>No goals added yet.</span></li>';
            return;
        }

        appData.goals.forEach(goal => {
            const listItem = document.createElement('li');
            listItem.className = 'bg-white p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-200';
            listItem.innerHTML = `
                <span>${goal.specific} (${goal.category}) - ${goal.measurableMetric}: ${goal.measurableTarget} - ${goal.currentProgress} - ${goal.targetDate}</span>
                <div>
                    <button class="text-blue-500 hover:text-blue-700"><i class="fas fa-edit"></i></button>
                    <button class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                </div>
            `;
            try {
                goalsList.appendChild(listItem);
            } catch (error) {
                console.error("Error appending goal list item:", error);
            }
        });
    }

    function updateDashboard() {
        // Task Summary
        const upcomingTasks = appData.tasks.filter(task => new Date(task.date) >= new Date());
        document.getElementById('dashboard-tasks-summary').textContent = upcomingTasks.length > 0
            ? `You have ${upcomingTasks.length} upcoming tasks.`
            : 'No upcoming tasks.';

        // Task Statistics
        const completedTasks = appData.tasks.filter(task => task.completed);
        const overdueTasks = appData.tasks.filter(task => new Date(task.date) < new Date() && !task.completed);
        document.getElementById('dashboard-task-stats').textContent = `Total: ${appData.tasks.length}, Completed: ${completedTasks.length}, Overdue: ${overdueTasks.length}`;

        // Budget Summary
        let totalIncome = 0;
        let totalExpenses = 0;
        appData.transactions.forEach(transaction => {
            if (transaction.mainCategory === 'Income') {
                totalIncome += parseFloat(transaction.amount);
            } else if (transaction.mainCategory === 'Expense') {
                totalExpenses += parseFloat(transaction.amount);
            }
        });
        document.getElementById('dashboard-budget-summary').textContent = `Income: $${totalIncome.toFixed(2)}, Expenses: $${totalExpenses.toFixed(2)}`;

        // Money Left This Month
        const currentDate = new Date();
        const firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        let moneyLeft = totalIncome - totalExpenses;
        document.getElementById('dashboard-money-left').textContent = `$${moneyLeft.toFixed(2)}`;

        // Recent Notes Summary
        const recentNotes = appData.notes.slice(-3);
        document.getElementById('dashboard-notes-summary').textContent = recentNotes.length > 0
            ? `You have ${appData.notes.length} notes.`
            : 'No recent notes.';
    }

    // --- Initial render ---
    renderTasks();
    renderTransactions();
    renderNotes();
    renderGoals();
    updateDashboard();
});
    </script>
</body>
</html>